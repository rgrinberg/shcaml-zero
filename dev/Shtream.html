<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Reader.html">
<link rel="next" href="ShtreamSig.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel="Appendix" href="index_types.html">
<link title="Index of exceptions" rel="Appendix" href="index_exceptions.html">
<link title="Index of values" rel="Appendix" href="index_values.html">
<link title="Index of class methods" rel="Appendix" href="index_methods.html">
<link title="Index of class types" rel="Appendix" href="index_class_types.html">
<link title="Index of modules" rel="Appendix" href="index_modules.html">
<link title="Index of module types" rel="Appendix" href="index_module_types.html">
<link title="Abort" rel="Chapter" href="Abort.html">
<link title="Adaptor" rel="Chapter" href="Adaptor.html">
<link title="AnyShtream" rel="Chapter" href="AnyShtream.html">
<link title="AnyShtreamSig" rel="Chapter" href="AnyShtreamSig.html">
<link title="Channel" rel="Chapter" href="Channel.html">
<link title="Delimited" rel="Chapter" href="Delimited.html">
<link title="DepDAG" rel="Chapter" href="DepDAG.html">
<link title="Disposal" rel="Chapter" href="Disposal.html">
<link title="Fitting" rel="Chapter" href="Fitting.html">
<link title="FittingSig" rel="Chapter" href="FittingSig.html">
<link title="Flags" rel="Chapter" href="Flags.html">
<link title="IVar" rel="Chapter" href="IVar.html">
<link title="Line" rel="Chapter" href="Line.html">
<link title="LineShtream" rel="Chapter" href="LineShtream.html">
<link title="PriorityQueue" rel="Chapter" href="PriorityQueue.html">
<link title="Proc" rel="Chapter" href="Proc.html">
<link title="Reader" rel="Chapter" href="Reader.html">
<link title="Shtream" rel="Chapter" href="Shtream.html">
<link title="ShtreamSig" rel="Chapter" href="ShtreamSig.html">
<link title="Signal" rel="Chapter" href="Signal.html">
<link title="StringShtream" rel="Chapter" href="StringShtream.html">
<link title="Util" rel="Chapter" href="Util.html">
<link title="UsrBin" rel="Chapter" href="UsrBin.html">
<link title="Version" rel="Chapter" href="Version.html">
<link title="WeakPlus" rel="Chapter" href="WeakPlus.html"><link title="Reading and Writing Shtreams" rel="Section" href="#1_ReadingandWritingShtreams">
<title>Shcaml : Shtream</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Reader.html" title="Reader">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="ShtreamSig.html" title="ShtreamSig">Next</a>
</div>
<h1>Module <a href="type_Shtream.html">Shtream</a></h1>

<pre><span class="keyword">module</span> Shtream: <code class="code"><span class="keyword">sig</span></code> <a href="Shtream.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
Base module for shtreams, an abstraction of producers of typed data.
<p>

 Shtreams are modeled on the standard library's <code class="code"><span class="constructor">Stream</span></code> module, but
 provide additional features.  The main difference is that a shtream
 is easily converted to and from another kind of data source: an
 <code class="code">in_channel</code>.  A shtream may be constructed from a channel (or a data
 source such as a command to run) by providing a reader to extract
 shtream elements from the <code class="code">in_channel</code>.  When converting a shtream
 back to a channel with <a href="Shtream.html#VALchannel_of"><code class="code"><span class="constructor">Shtream</span>.channel_of</code></a>, if the shtream was
 constructed from a channel in the first place, that channel is
 returned, but if some of the shtream construction is happening
 internally, a child process is spawned to compute the shtream
 asynchronously.
</p><p>

 Operations in this module are all
 indifferent to the type of elements in the <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a>.
 See modules <a href="AnyShtream.html"><code class="code"><span class="constructor">AnyShtream</span></code></a>, <a href="LineShtream.html"><code class="code"><span class="constructor">LineShtream</span></code></a>, and <a href="StringShtream.html"><code class="code"><span class="constructor">StringShtream</span></code></a> for
 operations specialized on the element type.
 Most shtream operations are common to all Shtream modules; these
 may also be found in <a href="Shtream.COMMON.html"><code class="code"><span class="constructor">Shtream</span>.<span class="constructor">COMMON</span></code></a>.<br>
</p></div>
<hr width="100%">

<pre><span id="EXCEPTIONFailure"><span class="keyword">exception</span> Failure</span></pre>
<div class="info ">
Raised on attempts to retrieve elements from an empty
 <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a>.  Callbacks such as the argument to <code class="code">from</code>
 or <code class="code">map</code> may raise this to indicate the end of the
 shtream they are producing.<br>
</div>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type">'a</code> t</span> </pre>
<div class="info ">
A shtream with elements of type <code class="code"><span class="keywordsign">'</span>a</code><br>
</div>


<pre><span id="EXCEPTIONCoFailure"><span class="keyword">exception</span> CoFailure</span></pre>
<div class="info ">
Raised if a coshtream is no longer accepting data.  This could
 happen, for example, were the shtream-consuming function to
 return before exhausting the shtream.<br>
</div>

<pre><span id="TYPEco_t"><span class="keyword">type</span> <code class="type">'a</code> co_t</span> </pre>
<div class="info ">
A coshtream accepting elements of type <code class="code"><span class="keywordsign">'</span>a</code><br>
</div>


<pre><span class="keyword">include</span> <a href="ShtreamSig.S.html">ShtreamSig.S</a><code class="type">
  with type 'a t    := 'a <a href="Shtream.html#TYPEt">t</a>
   and type 'a co_t := 'a <a href="Shtream.html#TYPEco_t">co_t</a></code></pre>
<br>
<h1 id="1_ReadingandWritingShtreams">Reading and Writing Shtreams</h1><br>

<pre><span id="VALchannel_of"><span class="keyword">val</span> channel_of</span> : <code class="type">?procref:<a href="Channel.html#TYPEprocref">Channel.procref</a> -&gt;<br>       ?before:(unit -&gt; unit) -&gt;<br>       ?after:(unit -&gt; unit) -&gt;<br>       ('a -&gt; unit) -&gt; 'a <a href="Shtream.html#TYPEt">t</a> -&gt; Pervasives.in_channel</code></pre><div class="info ">
Make an <code class="code">in_channel</code> from a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a>.
 <code class="code"><span class="constructor">Shtream</span>.channel_of writer s</code> returns an <code class="code">in_channel</code> whose contents
 correspond to the shtream <code class="code">s</code>.  If <code class="code">s</code> is already a channel, it may
 return that channel (or a copy).
<p>

 However, if <code class="code">s</code> is internal (made
 with <code class="code"><span class="constructor">Shtream</span>.from</code> or involves internal processing, it forks a
 child process with a pipe from its <code class="code">stdout</code>.  The child process calls
 <code class="code">writer</code> for each element of the shtream, and <code class="code">writer</code> must print
 that element to <code class="code">stdout</code>.  If <code class="code">?before</code> or <code class="code">?after</code> is given, those
 will be called before (or after) iterating the shtream in the child
 process.  If a process if forked and <code class="code">?procref</code> is given, its
 <a href="Proc.html#TYPEt"><code class="code"><span class="constructor">Proc</span>.t</code></a> is saved in the <code class="code">ref</code>.<br>
</p></div>

<pre><span id="VALof_channel"><span class="keyword">val</span> of_channel</span> : <code class="type">?hint:(<a href="Reader.html#TYPEraw_line">Reader.raw_line</a> -&gt; 'a) -&gt;<br>       (Pervasives.in_channel -&gt; 'a) -&gt; Pervasives.in_channel -&gt; 'a <a href="Shtream.html#TYPEt">t</a></code></pre><div class="info ">
 Construct a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a> from a reader and an <code class="code">in_channel</code>.
 The reader should raise <code class="code"><span class="constructor">End_of_file</span></code> to indicate the end of the
 channel.  It can also use
 <code class="code">shtream_errors</code>.
 The channel is dup'd for the shtream, which
 means that closing or duping onto it has no effect on the shtream.
<p>

 (The optional argument <code class="code">?hint</code> (default <code class="code"><span class="constructor">None</span></code>) is for internal use.
 It indicates that this reader was a default supplied by another
 function in the system rather than chosen by the reader, and thus
 the system remains free to select a different record reader.)<br>
</p></div>

<pre><span id="VALof_file"><span class="keyword">val</span> of_file</span> : <code class="type">?hint:(<a href="Reader.html#TYPEraw_line">Reader.raw_line</a> -&gt; 'a) -&gt;<br>       (Pervasives.in_channel -&gt; 'a) -&gt; string -&gt; 'a <a href="Shtream.html#TYPEt">t</a></code></pre><div class="info ">
 Construct a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a> from a reader and a filename.  The arguments
 are as for <a href="Shtream.html#VALof_channel"><code class="code"><span class="constructor">Shtream</span>.of_channel</code></a>.<br>
</div>

<pre><span id="VALof_command"><span class="keyword">val</span> of_command</span> : <code class="type">?procref:<a href="Channel.html#TYPEprocref">Channel.procref</a> -&gt;<br>       ?dups:<a href="Channel.html#TYPEdup_spec">Channel.dup_spec</a> -&gt;<br>       ?hint:(<a href="Reader.html#TYPEraw_line">Reader.raw_line</a> -&gt; 'a) -&gt;<br>       (Pervasives.in_channel -&gt; 'a) -&gt; string -&gt; 'a <a href="Shtream.html#TYPEt">t</a></code></pre><div class="info ">
 Construct a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a> from a reader and an external command.
 If <code class="code">?procref</code> is given, stash the child <a href="Proc.html#TYPEt"><code class="code"><span class="constructor">Proc</span>.t</code></a>; if <code class="code">?dups</code> is
 given, perform the dups in the child process.
 The remaining arguments are as for <a href="Shtream.html#VALof_channel"><code class="code"><span class="constructor">Shtream</span>.of_channel</code></a>.<br>
</div>

<pre><span id="VALof_program"><span class="keyword">val</span> of_program</span> : <code class="type">?procref:<a href="Channel.html#TYPEprocref">Channel.procref</a> -&gt;<br>       ?dups:<a href="Channel.html#TYPEdup_spec">Channel.dup_spec</a> -&gt;<br>       ?hint:(<a href="Reader.html#TYPEraw_line">Reader.raw_line</a> -&gt; 'a) -&gt;<br>       (Pervasives.in_channel -&gt; 'a) -&gt;<br>       ?path:bool -&gt; string -&gt; ?argv0:string -&gt; string list -&gt; 'a <a href="Shtream.html#TYPEt">t</a></code></pre><div class="info ">
 Construct a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a> from a reader and an external program.
 If <code class="code">?procref</code> is given, stash the child <a href="Proc.html#TYPEt"><code class="code"><span class="constructor">Proc</span>.t</code></a>; if <code class="code">?dups</code> is
 given, perform the dups in the child process.
 The remaining arguments are as for <a href="Shtream.html#VALof_channel"><code class="code"><span class="constructor">Shtream</span>.of_channel</code></a>.<br>
</div>

<pre><span id="VALof_thunk"><span class="keyword">val</span> of_thunk</span> : <code class="type">?procref:<a href="Channel.html#TYPEprocref">Channel.procref</a> -&gt;<br>       ?dups:<a href="Channel.html#TYPEdup_spec">Channel.dup_spec</a> -&gt;<br>       ?hint:(<a href="Reader.html#TYPEraw_line">Reader.raw_line</a> -&gt; 'a) -&gt;<br>       (Pervasives.in_channel -&gt; 'a) -&gt; (unit -&gt; unit) -&gt; 'a <a href="Shtream.html#TYPEt">t</a></code></pre><div class="info ">
 Construct a <a href="Shtream.html#TYPEt"><code class="code"><span class="constructor">Shtream</span>.t</code></a> from a reader and a thunk.
 Spawns a child and calls the thunk in the child process.
 If <code class="code">?procref</code> is given, stash the child <a href="Proc.html#TYPEt"><code class="code"><span class="constructor">Proc</span>.t</code></a>; if <code class="code">?dups</code> is
 given, perform the dups in the child process.
 The remaining arguments are as for <a href="Shtream.html#VALof_channel"><code class="code"><span class="constructor">Shtream</span>.of_channel</code></a>.<br>
</div>

<pre><span class="keyword">module type</span> <a href="Shtream.COMMON.html">COMMON</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Shtream.COMMON.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
The signature for operations common to all shtream modules.
</div>
</body></html>